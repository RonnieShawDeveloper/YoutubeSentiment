<div class="dashboard-container">
  <!-- Header/Toolbar -->
  <mat-toolbar color="primary" class="header-toolbar">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <div class="flex items-center">
        <mat-icon class="mr-2">play_circle_filled</mat-icon>
        <span class="font-heading font-bold">YouTube Video Analyzer</span>
      </div>

      <div class="flex items-center" *ngIf="userProfile">
        <div class="credits-badge mr-4">
          <span class="text-sm">Credits</span>
          <span class="credit-count">{{ userProfile.credits }}</span>
        </div>

        <button mat-button [matMenuTriggerFor]="userMenu" class="user-menu-button">
          <mat-icon>account_circle</mat-icon>
          <span class="ml-1 hidden md:inline">{{ userProfile.fullName }}</span>
          <mat-icon>arrow_drop_down</mat-icon>
        </button>

        <mat-menu #userMenu="matMenu">
          <div class="px-4 py-2 text-gray-600 text-sm">
            {{ userProfile.email }}
          </div>
          <mat-divider></mat-divider>
          <button mat-menu-item>
            <mat-icon>person</mat-icon>
            <span>Profile</span>
          </button>
          <button mat-menu-item>
            <mat-icon>credit_card</mat-icon>
            <span>Buy Credits</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item (click)="signOut()">
            <mat-icon>exit_to_app</mat-icon>
            <span>Sign Out</span>
          </button>
        </mat-menu>
      </div>
    </div>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8">
    <!-- Welcome Section -->
    <div class="welcome-section mb-8 slide-up">
      <h1 class="text-3xl font-heading font-bold text-gray-800 mb-2">Welcome, {{ userProfile?.fullName || 'User' }}!</h1>
      <p class="text-gray-600">Analyze YouTube videos and get detailed insights about your content.</p>
    </div>

    <!-- Video URL Input Section -->
    <mat-card class="mb-8 slide-up" style="animation-delay: 100ms;">
      <mat-card-content>
        <div class="p-4">
          <h2 class="text-xl font-heading font-semibold text-gray-800 mb-4">Analyze a YouTube Video</h2>

          <p class="text-gray-600 mb-4">We analyze all of your comments, and then take the top 100 most relevant comments
           and provide a detailed analysis to tell you what your viewers liked and didnt like.</p>

          <form [formGroup]="videoForm" (ngSubmit)="onSubmit()" class="flex flex-col md:flex-row gap-4">
            <mat-form-field appearance="outline" class="flex-grow">
              <mat-label>YouTube Video URL</mat-label>
              <input matInput formControlName="videoUrl" placeholder="https://www.youtube.com/watch?v=...">
              <mat-icon matPrefix class="mr-2 text-primary-400">link</mat-icon>
              <mat-error *ngIf="videoForm.get('videoUrl')?.hasError('required')">URL is required</mat-error>
              <mat-error *ngIf="videoForm.get('videoUrl')?.hasError('invalidYoutubeUrl')">Please enter a valid YouTube URL</mat-error>
            </mat-form-field>

            <button mat-raised-button color="accent" type="submit" [disabled]="videoForm.invalid || isLoading || (userProfile && userProfile.credits < 1)" class="analyze-button">
              <mat-icon>analytics</mat-icon>
              <span class="ml-1">Analyze</span>
            </button>
          </form>

          <div *ngIf="userProfile && userProfile.credits < 1" class="mt-2 text-red-500 text-sm">
            <mat-icon class="text-sm align-middle">warning</mat-icon>
            <span class="ml-1">You don't have enough credits. Please purchase more to continue.</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Reports Section -->
    <div class="reports-section slide-up" style="animation-delay: 200ms;">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-heading font-semibold text-gray-800">Your Reports</h2>
        <button mat-button color="primary" [disabled]="isLoadingReports" (click)="loadReports()">
          <mat-icon>refresh</mat-icon>
          <span class="ml-1">Refresh</span>
        </button>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="isLoadingReports" class="flex justify-center py-8">
        <mat-spinner [diameter]="40"></mat-spinner>
      </div>

      <!-- No Reports Message -->
      <mat-card *ngIf="!isLoadingReports && reports.length === 0" class="p-6 text-center">
        <mat-icon class="text-gray-400 text-6xl mb-4">description</mat-icon>
        <h3 class="text-lg font-medium text-gray-700 mb-2">No Reports Yet</h3>
        <p class="text-gray-500 mb-4">Analyze your first YouTube video to generate a report.</p>
      </mat-card>

      <!-- Reports List -->
      <div *ngIf="!isLoadingReports && reports.length > 0" class="reports-grid">
        <mat-card *ngFor="let report of reports" class="report-card" (click)="viewReport(report.id || '')">
          <mat-card-content>
            <div class="flex items-start">
              <div class="video-thumbnail mr-4" *ngIf="report.videoId">
                <img [src]="'https://img.youtube.com/vi/' + report.videoId + '/mqdefault.jpg'" alt="Video Thumbnail">
              </div>

              <div class="flex-grow">
                <h3 class="text-lg font-medium text-gray-800 mb-1 line-clamp-2">{{ report.videoTitle }}</h3>
                <p class="text-gray-500 text-sm mb-2">{{ formatDate(report.createdAt) }}</p>

                <div class="flex items-center mt-2">
                  <mat-icon class="text-primary-500 text-sm mr-1">visibility</mat-icon>
                  <span class="text-sm text-gray-600">View Report</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>

<!-- Toast for notifications -->
<p-toast position="bottom-right"></p-toast>
